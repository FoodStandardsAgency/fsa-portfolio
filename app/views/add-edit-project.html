{% extends "theme/layout.html" %}
{% block head %}{% endblock %}
{% block content %}
<div class="row">
	<div class="col-xl-1 col-md-1 col-sm-1 py-3"></div>
	<div class="col-xl-8 col-md-8 col-sm-10 py-3">
	
	<h1 class="project-title">{{title}}</h1>
	
	<br /><br />

		<form action="/{{portfolio}}/update" method="post">

		{% for fieldgroup in fieldgroups %}
		{% if fieldgroup.display %}
			<div class="project-field-group">
				<h2 class="heading-medium">{{fieldgroup.fieldgroup}}</h2>
				{% for label in fieldgroup.labels %}
				{% set labelIncluded = (label.included and ((not label.admin) or (label.admin and (isAdmin or label.editorcanview)))) %}
				{% if labelIncluded %}
				{% set readonly = ((label.admin and not isAdmin) or label.inputtype == 'auto') %}
				{% set label_col = 'col-sm-4 col-md-4' %}
				{% set input_col = 'col-sm-8 col-md-8' %}
				{% set date_input_col = 'col-sm-6 col-md-5' %}
				{% set link1_input_col = 'col-sm-4 col-md-3' %}
				{% set link2_input_col = 'col-sm-4 col-md-5' %}
				<div class="form-group row">
					<div class="{{label_col}}">{{label.label}}</div>
					{% switch label.inputtype %}
					{% case 'auto' %}
					{% case 'freetext' %}
					<div class="{{input_col}}">
						<input type="text" class="form-control" id="id_{{label.field}}" name="{{label.field}}" placeholder="Enter {{label.label}}" value="{{project[label.field]}}" {% if readonly %}readonly{% endif %}>
					</div>

					{% case 'smallfreetextarea' %}
					<div class="{{input_col}}">
						<textarea type="text" rows="2" class="form-control" id="id_{{label.field}}" name="{{label.field}}" placeholder="Enter {{label.label}}" {% if readonly %}readonly{% endif %}>{{project[label.field]}}</textarea>
					</div>
					{% case 'mediumfreetextarea' %}
					<div class="{{input_col}}">
						<textarea type="text" rows="4" class="form-control" id="id_{{label.field}}" name="{{label.field}}" placeholder="Enter {{label.label}}" {% if readonly %}readonly{% endif %}>{{project[label.field]}}</textarea>
					</div>
					{% case 'largefreetextarea' %}
					<div class="{{input_col}}">
						<textarea type="text" rows="6" class="form-control" id="id_{{label.field}}" name="{{label.field}}" placeholder="Enter {{label.label}}" {% if readonly %}readonly{% endif %}>{{project[label.field]}}</textarea>
					</div>
					{% case 'projectupdatetext' %}
					<div class="{{input_col}}">
						<div>
							<textarea type="text" rows="6" class="form-control" id="id_{{label.field}}" name="{{label.field}}" placeholder="Enter {{label.label}}" {% if readonly %}readonly{% endif %}>{{project[label.field]}}</textarea>
						</div>
						{% if project.lastupdate %}
						<div class="last-update-text">
							<p style="white-space: pre-wrap;"><span style="font-weight:700">{{ project.lastupdate.timestamp | date(globals.timestampFormat) | safe }}</span> - {{ project.lastupdate.text | safe }}</p>
						</div>
						{% endif %}
					</div>

					{% case 'optionlist' %}
					{% case 'predefinedlist' %}
					{% case 'ragchoice' %}
					{% case 'phasechoice' %}
					<div class="{{input_col}}">
						{% if options[label.field] %}
						<select class="form-control" id="id_{{label.field}}" name="{{label.field}}">
							{% for option in options[label.field] %}
							{% set selected = (option.value == project[label.field]) %}
							<option value="{{option.value}}" {% if selected %} selected{% endif %}>{{option.display}}</option>
							{% endfor %}
						</select>
						{% else %}
						<span><i>The {{label.label}} field has no options configured. Please contact the portfolio administrator</i></span>
						{% endif %}
					</div>

					{% case 'projectmultiselect' %}
					<div class="{{input_col}}">
						{% if options[label.field] %}
						<select class="selectpicker form-control" name="{{label.field}}" data-header="{{options[label.field].header}}" data-live-search="true" multiple>
							{% for option in options[label.field].items %}
							<option value="{{option.value}}" data-tokens="{{option.tokens}}">{{option.display}}</option>
							{% endfor %}
						</select>
						{% else %}
						<span><i>The {{label.label}} field has no options configured. Please contact the portfolio administrator</i></span>
						{% endif %}
					</div>

					{% case 'predefinedsearchablelist' %}
					<div class="{{input_col}}">
						{% if options[label.field] %}
						<select class="selectpicker form-control" name="{{label.field}}" data-header="{{options[label.field].header}}" data-live-search="true">
							{% for option in options[label.field].items %}
							<option value="{{option.value}}" data-tokens="{{option.tokens}}">{{option.display}}</option>
							{% endfor %}
						</select>
						{% else %}
						<span><i>The {{label.label}} field has no options configured. Please contact the portfolio administrator</i></span>
						{% endif %}
					</div>

					{% case 'multioptionlist' %}
					{% case 'predefinedmultilist' %}
					<div class="{{input_col}}">
						{% if options[label.field] %}
						<select class="selectpicker form-control" name="{{label.field}}" data-header="{{options[label.field].header}}" data-live-search="false" multiple>
							{% for option in options[label.field].items %}
							<option value="{{option.value}}">{{option.display}}</option>
							{% endfor %}
						</select>
						{% else %}
						<span><i>The {{label.label}} field has no options configured. Please contact the portfolio administrator</i></span>
						{% endif %}
					</div>

					{% case 'linkeditemlist' %}
					<div class="{{input_col}}">
						<!-- HIDDEN DYNAMIC ELEMENT TO CLONE -->
						<div class="form-group dynamic-element" style="display:none">
							<div class="row">
								<div class="col-md-3"><input type="text" class="form-control" name="{{label.field}}[][name]" placeholder="{{label.label}} name"></div>
								<div class="col-md-8"><input type="text" class="form-control" name="{{label.field}}[][link]" placeholder="{{label.label}} link"></div>
								<div class="col-md-1"><p class="delete">x</p></div>
							</div>
						</div>
						<!-- END OF HIDDEN ELEMENT -->

						<fieldset>
							<div class="dynamic-stuff">
								<!-- Dynamic element will be cloned here -->
								<!-- You can call clone function once if you want it to show it a first element-->
							</div>

							<p class="add-one">+ add documents</p>
						</fieldset>
					</div>

					{% case 'namedlink' %}
					<div class="{{link1_input_col}}">
						<input type="text" class="form-control" id="id_{{label.field}}_name" name="{{label.field}}[name]" placeholder="Enter {{label.label}} name" value="{{project[label.field].name}}" {% if readonly %}readonly{% endif %}>
					</div>
					<div class="{{link2_input_col}}">
						<input type="text" class="form-control" id="id_{{label.field}}_link" name="{{label.field}}[link]" placeholder="Enter {{label.label}} link" value="{{project[label.field].link}}" {% if readonly %}readonly{% endif %}>
					</div>

					{% case 'budget' %}
					<div class="col-sm-4">
						<div class="input-group mb-3">
							<div class="input-group-prepend">
								<span class="input-group-text">&pound;</span>
							</div>
							<input type="text" name="{{label.field}}" value="{{project[label.field]}}" id="ID_{{label.field}}" class="form-control" aria-label="Amount (to the nearest pound)" {% if readonly %}readonly{% endif %}>
							<div class="input-group-append">
								<span class="input-group-text">.00</span>
							</div>
						</div>
					</div>

					{% case 'percentage' %}
					<div class="col-sm-4">
						<div class="input-group mb-3">
							<input type="number" min="0" max="100" name="{{label.field}}" value="{{project[label.field]}}" id="ID_{{label.field}}" class="form-control" aria-label="Percentage from 1 to 100" {% if readonly %}readonly{% endif %}>
							<div class="input-group-append">
								<span class="input-group-text">%</span>
							</div>
						</div>
					</div>

					{% case 'date' %}
					<div class="{{date_input_col}}">
						<input type="date" name="{{label.field}}" value="{{project[label.field] | date('YYYY-MM-DD')}}" id="ID_{{label.field}}" class="form-control" aria-label="Date" {% if readonly %}readonly{% endif %}>
					</div>

					{% case 'month' %}
					<div class="{{date_input_col}}">
						<input type="month" name="{{label.field}}" value="{{project[label.field] | date('YYYY-MM')}}" id="ID_{{label.field}}" class="form-control" aria-label="Date" {% if readonly %}readonly{% endif %}>
					</div>


					{% case 'predefinedfield' %}
					{% default %}
					<div class="{{input_col}}">
						<span><i>The {{label.label}} field has no input configured. Please contact the portfolio administrator</i></span>
					</div>
					{% endswitch %}
				</div>
				{% else %}
				<input type="hidden" name="{{label.field}}" value="{{project[label.field]}}" id="ID_{{label.field}}">
				{% endif %}
				{% endfor %}
			</div>
		{% endif %}
		{% endfor %}

		<div class="form-group row">
			<div class="col-sm-12"><button class="btn btn-primary" type="submit">Submit</button></div>
		</div>

		</form>
	
	</div>
	<div class="col-xl-3 col-md-3 col-sm-1 py-3"></div>
</div>
{% endblock %}