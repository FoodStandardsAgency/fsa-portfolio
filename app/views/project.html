{% extends "theme/layout.html" %}

{% block head %}
	<!-- Script for hiding/ showing updates -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
	<script>
	$(document).ready(function () {
		size_li = $("#myList li").length;
		x=1;
		$('#myList li:lt('+x+')').show();
		$('#loadMore').click(function () {
			x= (x+1 <= size_li) ? x+1 : size_li;
			$('#myList li:lt('+x+')').show();
			 $('#showLess').show();
			if(x == size_li){
				$('#loadMore').hide();
			}
		});
		$('#showLess').click(function () {
			x=(x-1<0) ? 1 : x-1;
			$('#myList li').not(':lt('+x+')').hide();
			$('#loadMore').show();
			 $('#showLess').show();
			if(x == 1){
				$('#showLess').hide();
			}
		});
	});
	</script>
{% endblock %}

{% block content %}

<!-- Project IDs & Edit/ Delete links -->
<div class="row">
	<div class="col-xl-1 col-md-1 col-sm-1 py-3"></div>
	<div class="col-xl-7 col-md-7 col-sm-6 py-3">
	<p><strong>{{labels.project_id}}: </strong>{{ data.project_id }}
	
	<!-- Test if up to two other project IDs are passed, and display -->
	
	</p>
	</div>
	
	<!-- Change for access groups -->
	<div class="col-xl-3 col-md-3 col-sm-4 py-3 text-right">
	{% if user == 'portfolio' %}
	<a href="/portfolio-delete/{{ data.project_id }}">Delete</a> | 
	<a href="/{{portfolio}}/edit/{{ data.project_id }}">Update</a>
	{% elif user == 'odd' or  user == 'team_leaders'%}
	<a href="/{{portfolio}}/edit/{{ data.project_id }}">Update this project</a>
	{% endif%}
	</div>
	
	<div class="col-xl-1 col-md-1 col-sm-1 py-3"></div>
</div>

<!-- Project title -->
<div class="row">
	<div class="col-xl-1 col-md-1 col-sm-1 py-3"></div>
	<div class="col-xl-10 col-md-10 col-sm-10 py-3">
	<h1 class="project-title" style="">{{ data.project_name | safe }}
	{% if data.new_flag == 'Y' %}<span class="project-new">NEW</span>{% endif %}	
	</h1>
	</div>
	<div class="col-xl-1 col-md-1 col-sm-1 py-3"></div>
</div>


<!-- Projet description, flags and status -->
<div class="row">
	<div class="col-sm-1 py-3"></div>

	<div class="col-sm-8 py-3 pr-5">
	{% if data.short_desc %}{% endif %}
	<div class="desc-para"><p>{{ data.short_desc | safe }}</p></div><br />
			<br />
			<strong>{{labels.priority_main}}:</strong> 
	<div class="small-flag priority">{{ data.pgroup | capitalize }} ({{ data.priority_main }})</div>&nbsp;&nbsp;&nbsp;
	<strong>{{labels.rag}}:</strong> 
	
	{% set rag = data.rag %}
	
	{% if rag == 'gre' %}
	<div class="small-flag rag-green"><strong>Green</strong></div>
	
	{% elif rag == 'amb' %}
	<div class="small-flag rag-amber"><strong>Amber</strong></div>
	
	{% elif rag == 'red' %}
	<div class="small-flag rag-red"><strong>Red</strong></div>
	
	{% else %}
	<div class="small-flag rag-no"><strong>No RAG</strong></div>
	
	{% endif %}
	
	{% set onhold = data.onhold %}
	
	{% if onhold == 'y' %}
	<div class="small-flag onhold"><strong>On hold</strong></div>
	
	{% elif onhold == 'b' %}
	<div class="small-flag onhold"><strong>Blocked</strong></div>
	
	{% elif onhold == 'c' %}
	<div class="small-flag onhold"><strong>Covid-19 on hold</strong></div>
	
	{% endif %}
	
	
	</div>
	
	<div class="col-sm-2 py-3">
	{% if data.phase_modifier %}{% endif %}
	<div class="phase-circle">
		<p class="circle {{ data.phase | lower }}" style="background-color:#D53880;"></p>
		{% if data.phase_modifier %}<p class="phase_modifier">{{ data.phase_modifier }}</p>{% endif %}
		<p class="circle-label">{{ data.phase | title }}</p>
	</div>
	</div>
	<div class="col-xl-1 col-md-1 col-sm-1 py-3"></div>
</div>


<!-- Project team - list + lead, lead role, DM and directorate -->
<div class="row">
	<div class="col-sm-1 py-3"></div>
	<div class="col-sm-8 py-3 pr-5">
	
	{% if data.team %}
		<hr />
		<h2 class="heading-medium">{{ labels.team }}</h2>
		<p>{{ data.team }}</p>
		<br />
		<br />
	{% endif %}
	
	<hr />
	{% if upd_cnt > 0 %}
	<h2 class="heading-medium">{{labels.update}}</h2>

	<ul id="myList">
	{% for i in range(0, upd_cnt) %}
	<li><p style="white-space: pre-wrap;"><span style="font-weight:700">{{ updates[i].date | safe }}</span> - {{ updates[i].update | safe }}</p></li>
	{% endfor %}
	</ul>
	
	<p><span id="loadMore" style="font-weight:800;">Load more</span> <span id="showLess" style="font-weight:800;">| Show less</span></p>
	<br /><br />
	{% else %}
	
	<h2 class="heading-medium"> No updates</h2>
	<br /><br />
	{% endif %}
	
	
	{% if docs %}
		  <h2 class="heading-medium">{{labels.documents}}</h2>
			
			<div class="container">
			<div class="equalsplit2"><a href="{{ docs[1] | safe }}">{{ docs[0] | safe }}</a></div>
			<div class="equalsplit2"><a href="{{ docs[3] | safe }}">{{ docs[2] | safe }}</a></div>
			<div class="clear"></div>
			</div>
			<br />
			<div class="container">
			<div class="equalsplit2"><a href="{{ docs[5] | safe }}">{{ docs[4] | safe }}</a></div>
			<div class="equalsplit2"><a href="{{ docs[7] | safe }}">{{ docs[6] | safe }}</a></div>
			<div class="clear"></div>
			</div>
	<br /><br />
	{% endif %}
	
	{% if deps_cnt > 0 %}
		  <h2 class="heading-medium">{{labels.dependencies}}</h2>
				
				{% for i in range(0, deps_cnt) %}
				<a href="/projects/{{ deps[i].project_id }}">{{ deps[i].project_name }}</a><br /> 
				{% endfor %}

			{% endif %}
			
			{% if rels_cnt > 0 %}
			
				<h2 class="heading-medium">{{labels.rels}}</h2>
				
				{% for i in range(0, rels_cnt) %}
				<a href="/projects/{{ rels[i].project_id }}">{{ rels[i].project_name }}</a><br />
				{% endfor %}
	<br /><br />
	{% endif %}

	</div>
	<div class="col-sm-2 py-3">
	<br />
	{% if data.direct and data.direct != 'NONE' %}
	<h3 class="heading-small">{{labels.direct}}</h3>
		<p>
			  {% if data.direct == 'COMMS' %} 	Communications
			  {% elif data.direct == 'IR' %}	Incidents & Resilience
			  {% elif data.direct == 'FO' %}	Field Operations
			  {% elif data.direct == 'FP' %}	Finance & Performance
			  {% elif data.direct == 'FSP' %}	Food Safety Policy
			  {% elif data.direct == 'FSA' %}	FSA wide
			  {% elif data.direct == 'NFCU' %}	National Food Crime Unit
			  {% elif data.direct == 'NI' %}	Northern Ireland
			  {% elif data.direct == 'ODD' %}	Openness, Data & Digital
			  {% elif data.direct == 'PEOP' %}	People
			  {% elif data.direct == 'RC' %}	Regulatory Compliance
			  {% elif data.direct == 'SERD' %}	Science, Evidence & Research
			  {% elif data.direct == 'SLG' %}	Strategy, Legal & Governance
			  {% elif data.direct == 'WAL' %}	Wales
			{% endif %}
		</p>
		{% endif %}
			
		{% if data.oddlead %}<h3 class="heading-small">{{labels.oddlead}}</h3>
		<p>
		{{ data.oddlead | safe }}<br />
		<a href="mailto:{{ data.oddlead_email }}">{{ data.oddlead_email | safe}}</a>
		</p>
		
		{% if data.oddlead_role == 'sup' or data.oddlead_role == 'imp' or data.oddlead_role == 'man' %}
		<h3 class="heading-small">{{labels.oddlead_role}}</h3>
		<p>
		{% if data.oddlead_role == 'sup' %} Support
		{% elif data.oddlead_role == 'imp' %} Implementation
		{% elif data.oddlead_role == 'man' %} Management
		{% endif %}
		</p>
		{% endif %}
		
		{% else %}
			<p>{{ data.oddlead | default('Not set') }}</p>
	{% endif %}
	
	{% if data.servicelead %}
			<h3 class="heading-small">{{labels.servicelead_email}}</h3>

			<p>
			{{ data.servicelead | safe }}<br />
			<a href="mailto:{{ data.servicelead_email }}">{{ data.servicelead_email | safe}}</a>
			</p>
			{% endif %}
			
			{% if dates[10] or dates[11] or dates[12] or dates[13] or dates [14] or comp %}
			<br /><h3 class="heading-small">Key dates</h3>
				  <p>
				  	{% if dates[10] %}{{labels.start_date}}:<br /> {{ dates[0] }} {{ dates[1] }} <br /><br />{% endif %}
				  	{% if dates[11] %}{{labels.actstart}}:<br /> {{ dates[2] }} {{ dates[3] }} {{ dates[4] }}<br /><br />{% endif %}
				  	{% if dates[14] %}{{labels.expendp}}:<br /> {{ dates[15] }} {{ dates[16] }} {{ dates[17] }} <br /><br />{% endif %}
				  	{% if dates[12] %}{{labels.expend}}:<br /> {{ dates[5] }} {{ dates[6] }} <br /><br />{% endif %}
				  	{% if dates[13] %}{{labels.hardend}}:<br /> {{ dates[7] }} {{ dates[8] }} {{ dates[9] }}<br /><br />{% endif %}
				  	{% if comp %}{{labels.actual_end_date}}:<br /> {{ comp[2] }} {{ comp[1] }} {{ comp[3] }}<br /><br />{% endif %}
				  </p>
			
			{% endif %}
			
			{% if data.p_comp > 0 %}
				  <h3 class="heading-small">{{labels.p_comp}}</h3>
			<p>
			{{ data.p_comp }}%
			</p>
			{% endif %}
					
			{% if data.project_size == 's' or data.project_size == 'm' or data.project_size == 'l'  or data.project_size == 'x' or link[1] %} <br /> {% endif %}
			
			{% if data.project_size == 's' or data.project_size == 'm' or data.project_size == 'l'  or data.project_size == 'x' %}
			<h3 class="heading-small">{{labels.project_size}}</h3>
			<p>
			{% if data.project_size == 's' %} Small
			{% elif data.project_size == 'm' %} Medium
			{% elif data.project_size == 'l' %} Large
			{% elif data.project_size == 'x' %} Extra large
			{% endif %}
			</p>
			{% endif %}

			{% if link[1] %}
			<h3 class="heading-small">{{labels.link}}</h3>
			
				<a href="{{ link[1] }}" target="_blank" title="Project channel">
					<p>{{ link[0]}}</p>
				</a>
			{% endif %}
			
	
			{% if (data.budget) and (group != '4') %}
				
				<br /><h3 class="heading-small">Budget</h3>
				{% if data.budget == 0 %}	Not applicable	
				
				{% else %}
					<strong>{{labels.budgettype}}:</strong> {{ budgettype }} <br />
					<strong>{{labels.budget}}:</strong> {{ budget }} <br />
					{% if data.spent %}	<strong>{{labels.spent}}:</strong> {{ spent }} {% endif %}
				{% endif %}
								
				
			{% endif %}
	</div>

	</div>
	<div class="col-sm-1 py-3">
	</div>
	<div class="col-sm-1 py-3"></div>
</div>

{% endblock %}
